<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéí Mission Scout - Jeu Complet üèïÔ∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --orange: #F77F00;
            --forest: #2E7D32;
            --parchment: #FAF3E0;
            --wood: #E7D9C2;
            --ink: #1E1E1E;
            --gold: #FFD166;
            --blue: #4A90E2;
            --purple: #9B59B6;
            --pink: #E91E63;
            --green: #27AE60;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, var(--forest) 0%, #1B1F3B 100%);
            min-height: 100vh;
            padding: 1rem;
            overflow-x: hidden;
        }

        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .container {
            background: var(--parchment);
            border-radius: 32px;
            padding: 3rem;
            max-width: 1400px;
            margin: 0 auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border: 4px solid var(--wood);
        }

        .main-title {
            font-family: 'Patrick Hand', cursive;
            color: var(--ink);
            font-size: 4rem;
            text-align: center;
            margin-bottom: 1rem;
            text-shadow: 4px 4px 0 var(--gold);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .subtitle {
            text-align: center;
            color: var(--forest);
            font-size: 1.5rem;
            margin-bottom: 3rem;
            font-style: italic;
        }

        /* Mode Selection Cards */
        .modes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 3rem 0;
        }

        .mode-card {
            background: white;
            border: 5px solid var(--ink);
            border-radius: 24px;
            padding: 2.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 6px 6px 0 var(--ink);
            position: relative;
            overflow: hidden;
        }

        .mode-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            transform: rotate(45deg);
            transition: all 0.5s ease;
        }

        .mode-card:hover::before {
            left: 100%;
        }

        .mode-card:hover {
            transform: translateY(-10px) rotate(-2deg);
            box-shadow: 10px 10px 0 var(--ink);
        }

        .mode-card.locked {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .mode-emoji {
            font-size: 5rem;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .mode-name {
            font-family: 'Patrick Hand', cursive;
            font-size: 2rem;
            color: var(--orange);
            text-align: center;
            margin-bottom: 1rem;
        }

        .mode-desc {
            text-align: center;
            color: #666;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .mode-difficulty {
            text-align: center;
            padding: 0.5rem;
            border-radius: 12px;
            font-weight: bold;
            margin-top: 1rem;
        }

        .difficulty-easy { background: #C8E6C9; color: #2E7D32; }
        .difficulty-medium { background: #FFE0B2; color: #F57C00; }
        .difficulty-hard { background: #FFCDD2; color: #C62828; }
        .difficulty-expert { background: #E1BEE7; color: #7B1FA2; }

        .lock-icon {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 2rem;
        }

        /* Stats Display */
        .player-stats {
            background: linear-gradient(135deg, var(--purple), var(--pink));
            border: 4px solid var(--ink);
            border-radius: 24px;
            padding: 2rem;
            margin-bottom: 3rem;
            color: white;
            box-shadow: 6px 6px 0 var(--ink);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-family: 'Patrick Hand', cursive;
            font-size: 2.5rem;
            font-weight: bold;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 0.5rem;
        }

        /* Game Area */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: white;
            border: 4px solid var(--ink);
            border-radius: 20px;
            box-shadow: 4px 4px 0 var(--ink);
        }

        .timer {
            font-family: 'Patrick Hand', cursive;
            font-size: 2rem;
            color: var(--orange);
        }

        .game-score {
            font-family: 'Patrick Hand', cursive;
            font-size: 2rem;
            color: var(--forest);
        }

        .items-pool {
            background: white;
            border: 5px solid var(--ink);
            border-radius: 24px;
            padding: 2rem;
            margin-bottom: 2rem;
            min-height: 400px;
            box-shadow: 6px 6px 0 var(--ink);
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .item {
            background: linear-gradient(135deg, var(--orange), var(--gold));
            border: 4px solid var(--ink);
            border-radius: 20px;
            padding: 1.5rem 1rem;
            cursor: grab;
            transition: all 0.3s ease;
            text-align: center;
            box-shadow: 4px 4px 0 var(--ink);
        }

        .item:hover {
            transform: translateY(-10px) rotate(5deg) scale(1.05);
            box-shadow: 6px 6px 0 var(--ink);
        }

        .item-emoji {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .item-name {
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .item.placed {
            opacity: 0.3;
            pointer-events: none;
        }

        .bags-area {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .bag {
            background: white;
            border: 5px dashed var(--ink);
            border-radius: 24px;
            padding: 1.5rem;
            min-height: 180px;
            transition: all 0.3s ease;
        }

        .bag.drag-over {
            background: rgba(247, 127, 0, 0.2);
            border-style: solid;
            border-color: var(--orange);
            transform: scale(1.05);
        }

        .bag-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 3px solid var(--wood);
        }

        .bag-emoji {
            font-size: 2.5rem;
        }

        .bag-name {
            font-family: 'Patrick Hand', cursive;
            font-size: 1.4rem;
            color: var(--ink);
            flex: 1;
        }

        .bag-count {
            background: var(--orange);
            color: white;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 3px solid var(--ink);
        }

        .bag-items {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            min-height: 60px;
        }

        .bag .item {
            background: linear-gradient(135deg, var(--green), #4CAF50);
            transform: scale(0.8);
        }

        /* Learning Mode Specific */
        .info-panel {
            background: linear-gradient(135deg, #E3F2FD, #BBDEFB);
            border: 4px solid var(--blue);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .info-title {
            font-family: 'Patrick Hand', cursive;
            font-size: 1.8rem;
            color: var(--blue);
            margin-bottom: 1rem;
        }

        .tip-card {
            background: white;
            border: 3px solid var(--ink);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        /* Weather Mode */
        .weather-panel {
            background: linear-gradient(135deg, #FFF3E0, #FFE0B2);
            border: 4px solid var(--orange);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .weather-icon {
            font-size: 5rem;
            margin-bottom: 1rem;
        }

        .temperature {
            font-family: 'Patrick Hand', cursive;
            font-size: 3rem;
            color: var(--orange);
        }

        /* Buttons */
        .btn {
            background: var(--orange);
            color: white;
            border: 4px solid var(--ink);
            border-radius: 25px;
            padding: 1.2rem 2.5rem;
            font-family: 'Patrick Hand', cursive;
            font-size: 1.3rem;
            cursor: pointer;
            box-shadow: 4px 4px 0 var(--ink);
            transition: all 0.3s ease;
            display: inline-block;
            margin: 0.5rem;
        }

        .btn:hover {
            background: var(--gold);
            transform: translateY(-3px);
            box-shadow: 6px 6px 0 var(--ink);
        }

        .btn-secondary {
            background: var(--blue);
        }

        .btn-back {
            background: #666;
            padding: 0.8rem 1.5rem;
            font-size: 1.1rem;
        }

        /* Progress & Achievements */
        .progress-ring {
            text-align: center;
            margin: 2rem 0;
        }

        .progress-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: conic-gradient(var(--green) 0deg, var(--wood) 0deg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            position: relative;
        }

        .progress-inner {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .achievement {
            background: white;
            border: 3px solid var(--ink);
            border-radius: 16px;
            padding: 1rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .achievement.unlocked {
            background: linear-gradient(135deg, var(--gold), var(--orange));
            color: white;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .achievement.locked {
            opacity: 0.4;
        }

        .achievement-emoji {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .achievement-name {
            font-size: 0.8rem;
            font-weight: bold;
        }

        @media (max-width: 968px) {
            .main-title {
                font-size: 2.5rem;
            }
            
            .modes-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- MENU PRINCIPAL -->
    <div id="menuScreen" class="screen active">
        <div class="container">
            <h1 class="main-title">üéí Mission Scout üèïÔ∏è</h1>
            <p class="subtitle">Pr√©pare ton sac pour l'aventure !</p>

            <div class="player-stats">
                <h2 style="font-family: 'Patrick Hand', cursive; font-size: 2rem; text-align: center; margin-bottom: 1rem;">
                    üë§ Profil Scout
                </h2>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="playerLevel">1</div>
                        <div class="stat-label">üéñÔ∏è Niveau</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="playerRank">Louveteau</div>
                        <div class="stat-label">üìä Rang</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalScore">0</div>
                        <div class="stat-label">‚≠ê Score Total</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="achievementCount">0/35</div>
                        <div class="stat-label">üèÜ Badges</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="streakCount">0</div>
                        <div class="stat-label">üî• S√©rie</div>
                    </div>
                </div>
            </div>

            <h2 style="font-family: 'Patrick Hand', cursive; font-size: 2.5rem; text-align: center; color: var(--ink); margin: 2rem 0;">
                üéÆ Choisis ton Mode de Jeu
            </h2>

            <div class="modes-grid">
                <div class="mode-card" onclick="startMode('learn')">
                    <div class="mode-emoji">üìö</div>
                    <div class="mode-name">Mode Apprentissage</div>
                    <div class="mode-desc">
                        D√©couvre chaque sac avec des explications d√©taill√©es. Parfait pour d√©buter !
                    </div>
                    <div class="mode-difficulty difficulty-easy">
                        ‚≠ê FACILE - Id√©al pour apprendre
                    </div>
                </div>

                <div class="mode-card" onclick="startMode('quick')">
                    <div class="mode-emoji">‚ö°</div>
                    <div class="mode-name">Mode Rapide</div>
                    <div class="mode-desc">
                        3 minutes chrono ! Range tous les objets le plus vite possible.
                    </div>
                    <div class="mode-difficulty difficulty-medium">
                        ‚≠ê‚≠ê MOYEN - Action !
                    </div>
                </div>

                <div class="mode-card" onclick="startMode('weather')">
                    <div class="mode-emoji">üå¶Ô∏è</div>
                    <div class="mode-name">Mode M√©t√©o</div>
                    <div class="mode-desc">
                        Adapte ton sac selon la m√©t√©o du jour. Pluie, froid ou soleil ?
                    </div>
                    <div class="mode-difficulty difficulty-medium">
                        ‚≠ê‚≠ê MOYEN - Strat√©gie
                    </div>
                </div>

                <div class="mode-card" onclick="startMode('expert')" id="expertMode">
                    <div class="mode-emoji">üéì</div>
                    <div class="mode-name">Mode Expert</div>
                    <div class="mode-desc">
                        Aucune erreur permise ! D√©fis sp√©ciaux et temps limit√©.
                    </div>
                    <div class="mode-difficulty difficulty-hard">
                        ‚≠ê‚≠ê‚≠ê DIFFICILE
                    </div>
                </div>

                <div class="mode-card locked" id="storyMode">
                    <div class="lock-icon">üîí</div>
                    <div class="mode-emoji">üìñ</div>
                    <div class="mode-name">Mode Histoire</div>
                    <div class="mode-desc">
                        Suis l'aventure scout avec des missions progressives.
                    </div>
                    <div class="mode-difficulty difficulty-expert">
                        ‚≠ê‚≠ê‚≠ê‚≠ê BIENT√îT !
                    </div>
                </div>

                <div class="mode-card" onclick="showAchievements()">
                    <div class="mode-emoji">üèÜ</div>
                    <div class="mode-name">Mes Badges</div>
                    <div class="mode-desc">
                        Consulte tous tes achievements et statistiques compl√®tes.
                    </div>
                    <div class="mode-difficulty" style="background: var(--gold); color: var(--ink);">
                        üìä PROGRESSION
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 3rem;">
                <button class="btn btn-secondary" onclick="showReference()">
                    üìñ Guide de R√©f√©rence
                </button>
            </div>
        </div>
    </div>

    <!-- √âCRAN DE JEU -->
    <div id="gameScreen" class="screen">
        <div class="container">
            <div class="game-header">
                <button class="btn btn-back" onclick="backToMenu()">‚Üê Retour</button>
                <div class="timer" id="gameTimer">‚è±Ô∏è 3:00</div>
                <div class="game-score">Score: <span id="gameScore">0</span></div>
            </div>

            <div id="weatherPanel" class="weather-panel" style="display: none;">
                <div class="weather-icon" id="weatherIcon">üå¶Ô∏è</div>
                <div class="temperature" id="weatherTemp">15¬∞C</div>
                <p id="weatherDesc" style="font-size: 1.2rem; color: #666; margin-top: 1rem;">
                    Ciel variable avec risque de pluie
                </p>
            </div>

            <div id="infoPanel" class="info-panel" style="display: none;">
                <div class="info-title" id="infoTitle">üí° Conseil Scout</div>
                <div id="infoContent"></div>
            </div>

            <div class="items-pool">
                <h3 style="font-family: 'Patrick Hand', cursive; font-size: 2rem; color: var(--orange); margin-bottom: 1rem;">
                    üéÅ Objets √† Ranger (<span id="itemsRemaining">34</span> restants)
                </h3>
                <div class="items-grid" id="itemsPool"></div>
            </div>

            <div class="bags-area" id="bagsArea"></div>

            <div style="text-align: center;">
                <button class="btn" onclick="validateGame()">‚úÖ Valider mon Sac</button>
            </div>
        </div>
    </div>

    <!-- √âCRAN BADGES -->
    <div id="achievementsScreen" class="screen">
        <div class="container">
            <button class="btn btn-back" onclick="backToMenu()">‚Üê Retour</button>
            
            <h1 style="font-family: 'Patrick Hand', cursive; font-size: 3rem; text-align: center; color: var(--orange); margin: 2rem 0;">
                üèÜ Mes Badges Scout
            </h1>

            <div class="progress-ring">
                <div class="progress-circle" id="achievementCircle">
                    <div class="progress-inner">
                        <div style="font-family: 'Patrick Hand', cursive; font-size: 2.5rem; color: var(--orange);" id="achievementPercent">
                            0%
                        </div>
                        <div style="font-size: 0.9rem; color: #666;">Compl√©t√©</div>
                    </div>
                </div>
            </div>

            <div class="achievement-grid" id="achievementGrid"></div>
        </div>
    </div>

    <script>
        // Data
        const items = [
            { id: 1, name: 'Sac √† dos 40L', emoji: 'üéí', bag: 'sac', tip: 'Un bon sac de 40L est parfait pour un week-end !' },
            { id: 2, name: 'Sac de couchage 0¬∞C', emoji: 'üõèÔ∏è', bag: 'sac', tip: 'Confort 0¬∞C pour les nuits d\'octobre' },
            { id: 3, name: 'Sac √† viande', emoji: 'üß£', bag: 'sac', tip: 'Ajoute 5¬∞C de chaleur au sac de couchage' },
            { id: 4, name: 'Matelas', emoji: 'üü´', bag: 'sac', tip: 'Isole du sol froid et rend le sommeil confortable' },
            { id: 5, name: 'Oreiller', emoji: 'üí§', bag: 'sac', tip: 'Optionnel mais am√©liore le confort' },
            
            { id: 6, name: 'T-shirts (2)', emoji: 'üëï', bag: 'vetements', tip: 'Un pour le jour, un de rechange' },
            { id: 7, name: 'Sous-pull thermique', emoji: 'üß•', bag: 'vetements', tip: 'Couche de base - √©vacue la transpiration', weather: 'cold' },
            { id: 8, name: 'Pantalon', emoji: 'üëñ', bag: 'vetements', tip: 'Confortable et qui s√®che vite' },
            { id: 9, name: 'Surpantalon', emoji: 'ü¶∫', bag: 'vetements', tip: 'Protection imperm√©able contre la pluie', weather: 'rain' },
            { id: 10, name: 'Polaire', emoji: 'üß∂', bag: 'vetements', tip: 'Couche d\'isolation - garde la chaleur', weather: 'cold' },
            { id: 11, name: 'K-way', emoji: 'üåßÔ∏è', bag: 'vetements', tip: 'Couche de protection - bloque vent et pluie', weather: 'rain' },
            { id: 12, name: 'Sous-v√™tements', emoji: 'ü©≤', bag: 'vetements', tip: 'Change chaque jour !' },
            { id: 13, name: 'Chaussettes (4)', emoji: 'üß¶', bag: 'vetements', tip: 'R√®gle d\'or : 2 paires minimum !', weather: 'cold' },
            { id: 14, name: 'Pyjama', emoji: 'üåô', bag: 'vetements', tip: 'Un pyjama chaud pour les nuits fra√Æches' },
            { id: 15, name: 'Foulard scout', emoji: 'üî∂', bag: 'vetements', tip: 'Symbole scout, toujours avec toi !' },
            { id: 16, name: 'Gants', emoji: 'üß§', bag: 'vetements', tip: 'Pour les matins froids', weather: 'cold' },
            { id: 17, name: 'Chaussures boue', emoji: 'üëü', bag: 'vetements', tip: 'Imperm√©ables pour la journ√©e' },
            { id: 18, name: 'Chaussures soir', emoji: 'üëû', bag: 'vetements', tip: 'Une paire s√®che pour le soir' },
            
            { id: 19, name: 'Brosse √† dents', emoji: 'ü™•', bag: 'hygiene', tip: 'Hygi√®ne essentielle, m√™me en camp !' },
            { id: 20, name: 'Dentifrice', emoji: 'üß¥', bag: 'hygiene', tip: 'Privil√©gie le biod√©gradable' },
            { id: 21, name: 'Serviette', emoji: 'üèñÔ∏è', bag: 'hygiene', tip: 'Microfibre : s√®che 3x plus vite !' },
            { id: 22, name: 'Mouchoirs', emoji: 'ü§ß', bag: 'hygiene', tip: 'Indispensable en automne' },
            
            { id: 23, name: 'Gourde', emoji: 'üíß', bag: 'repas', tip: 'Bois 1L minimum par jour' },
            { id: 24, name: 'Thermos', emoji: '‚òï', bag: 'repas', tip: 'Chocolat chaud du matin !' },
            { id: 25, name: 'Gamelle', emoji: 'üçΩÔ∏è', bag: 'repas', tip: 'Aluminium : l√©ger et r√©sistant' },
            { id: 26, name: 'Couverts', emoji: 'üç¥', bag: 'repas', tip: 'Un 3-en-1 √©conomise de la place' },
            
            { id: 27, name: 'Lampe frontale', emoji: 'üî¶', bag: 'divers', tip: 'Lib√®re les mains !' },
            { id: 28, name: 'Piles', emoji: 'üîã', bag: 'divers', tip: 'Toujours avoir des rechanges' },
            { id: 29, name: 'Opinel', emoji: 'üî™', bag: 'divers', tip: 'Mod√®le bout rond pour la s√©curit√©' },
            { id: 30, name: 'Sacs poubelle', emoji: 'üóëÔ∏è', bag: 'divers', tip: 'Pour prot√©ger ou pour les d√©chets' },
            { id: 31, name: 'Pochettes √©tanches', emoji: 'üíº', bag: 'divers', tip: 'Prot√®ge documents et √©lectronique' },
            { id: 32, name: 'Feuille + crayon', emoji: '‚úèÔ∏è', bag: 'divers', tip: 'Pour noter tes aventures' },
            { id: 33, name: 'Jeu de l\'escapade', emoji: 'üé≤', bag: 'divers', tip: 'Le jeu officiel scout !' },
            { id: 34, name: 'V√™tements cocoon', emoji: 'üßò', bag: 'divers', tip: 'Confort pour le soir au camp' }
        ];

        const bags = [
            { id: 'sac', name: 'Sac & Couchage', emoji: 'üéí', total: 5, color: '#9B59B6' },
            { id: 'vetements', name: 'V√™tements', emoji: 'üëï', total: 18, color: '#E91E63' },
            { id: 'hygiene', name: 'Hygi√®ne', emoji: 'üöø', total: 4, color: '#4A90E2' },
            { id: 'repas', name: 'Repas', emoji: 'üçΩÔ∏è', total: 4, color: '#27AE60' },
            { id: 'divers', name: 'Divers', emoji: 'üéØ', total: 8, color: '#F39C12' }
        ];

        const achievements = [
            { id: 'first', name: 'Premier Pas', emoji: 'üéØ', desc: 'Range ton premier objet' },
            { id: 'perfect', name: 'Sans Faute', emoji: 'üíé', desc: 'Aucune erreur' },
            { id: 'speed', name: '√âclair', emoji: '‚ö°', desc: 'Finis en moins de 2min' },
            { id: 'combo5', name: 'Combo x5', emoji: 'üî•', desc: '5 bonnes r√©ponses d\'affil√©e' },
            { id: 'allModes', name: 'Explorateur', emoji: 'üó∫Ô∏è', desc: 'Essaie tous les modes' }
        ];

        // Game State
        let currentMode = null;
        let gameScore = 0;
        let timerInterval = null;
        let timeLeft = 180;
        let placedItems = [];
        let playerData = {
            level: 1,
            rank: 'Louveteau',
            totalScore: 0,
            achievements: [],
            streak: 0,
            modesCompleted: []
        };

        // Initialize
        function init() {
            loadPlayerData();
            updatePlayerStats();
            
        }

        function loadPlayerData() {
            const saved = localStorage.getItem('scoutMissionData');
            if (saved) {
                playerData = JSON.parse(saved);
            }
        }

        function savePlayerData() {
            localStorage.setItem('scoutMissionData', JSON.stringify(playerData));
        }

        function updatePlayerStats() {
            document.getElementById('playerLevel').textContent = playerData.level;
            document.getElementById('playerRank').textContent = playerData.rank;
            document.getElementById('totalScore').textContent = playerData.totalScore;
            document.getElementById('achievementCount').textContent = `${playerData.achievements.length}/${achievements.length}`;
            document.getElementById('streakCount').textContent = playerData.streak;
        }

        function startMode(mode) {
            currentMode = mode;
            showScreen('gameScreen');
            
            // Configure selon le mode
            if (mode === 'learn') {
                document.getElementById('infoPanel').style.display = 'block';
                showLearningTip();
                timeLeft = 600; // 10 minutes
            } else if (mode === 'quick') {
                timeLeft = 180; // 3 minutes
            } else if (mode === 'weather') {
                document.getElementById('weatherPanel').style.display = 'block';
                generateWeather();
                timeLeft = 240; // 4 minutes
            } else if (mode === 'expert') {
                timeLeft = 150; // 2.5 minutes
            }
            
            initGame();
        }

        function initGame() {
            gameScore = 0;
            placedItems = [];
            document.getElementById('gameScore').textContent = gameScore;
            renderItems();
            renderBags();
            startTimer();
        }

        function renderItems() {
            const pool = document.getElementById('itemsPool');
            pool.innerHTML = '';
            
            let itemsToShow = [...items];
            
            // En mode m√©t√©o, filtre les items
            if (currentMode === 'weather') {
                const weather = document.getElementById('weatherIcon').textContent;
                if (weather.includes('‚òÄÔ∏è')) {
                    itemsToShow = items.filter(i => !i.weather || i.weather !== 'cold');
                }
            }
            
            itemsToShow.forEach(item => {
                const el = document.createElement('div');
                el.className = 'item';
                el.draggable = true;
                el.dataset.id = item.id;
                el.dataset.bag = item.bag;
                el.innerHTML = `
                    <div class="item-emoji">${item.emoji}</div>
                    <div class="item-name">${item.name}</div>
                `;
                el.addEventListener('dragstart', handleDragStart);
                el.addEventListener('dragend', handleDragEnd);
                pool.appendChild(el);
            });
            
            updateItemsRemaining();
        }

        function renderBags() {
            const area = document.getElementById('bagsArea');
            area.innerHTML = '';
            
            bags.forEach(bag => {
                const el = document.createElement('div');
                el.className = 'bag';
                el.dataset.bagId = bag.id;
                el.innerHTML = `
                    <div class="bag-header">
                        <div class="bag-emoji">${bag.emoji}</div>
                        <div class="bag-name">${bag.name}</div>
                        <div class="bag-count" id="count-${bag.id}" style="background: ${bag.color};">0</div>
                    </div>
                    <div class="bag-items" id="bag-${bag.id}"></div>
                `;
                
                el.addEventListener('dragover', e => { e.preventDefault(); el.classList.add('drag-over'); });
                el.addEventListener('dragleave', e => el.classList.remove('drag-over'));
                el.addEventListener('drop', e => handleDrop(e, bag.id));
                
                area.appendChild(el);
            });
        }

        let draggedItem = null;

        function handleDragStart(e) {
            draggedItem = e.target;
            e.target.style.opacity = '0.5';
        }

        function handleDragEnd(e) {
            e.target.style.opacity = '1';
        }

        function handleDrop(e, bagId) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            const itemBag = draggedItem.dataset.bag;
            const itemId = parseInt(draggedItem.dataset.id);
            
            if (bagId === itemBag) {
                // Correct!
                const bagItems = document.getElementById(`bag-${bagId}`);
                bagItems.appendChild(draggedItem);
                draggedItem.classList.add('placed');
                
                gameScore += 100;
                placedItems.push(itemId);
                
                document.getElementById('gameScore').textContent = gameScore;
                updateBagCount(bagId);
                updateItemsRemaining();
                
                if (currentMode === 'learn') {
                    const item = items.find(i => i.id === itemId);
                    showItemTip(item);
                }
                
                // Check win
                if (placedItems.length === items.length) {
                    setTimeout(winGame, 500);
                }
            } else {
                // Wrong!
                draggedItem.style.animation = 'shake 0.5s ease';
                setTimeout(() => draggedItem.style.animation = '', 500);
                
                if (currentMode === 'expert') {
                    gameScore -= 50;
                    document.getElementById('gameScore').textContent = gameScore;
                }
            }
        }

        function updateBagCount(bagId) {
            const count = document.getElementById(`bag-${bagId}`).children.length;
            document.getElementById(`count-${bagId}`).textContent = count;
        }

        function updateItemsRemaining() {
            const remaining = items.length - placedItems.length;
            document.getElementById('itemsRemaining').textContent = remaining;
        }

        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                const min = Math.floor(timeLeft / 60);
                const sec = timeLeft % 60;
                document.getElementById('gameTimer').textContent = `‚è±Ô∏è ${min}:${sec.toString().padStart(2, '0')}`;
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    winGame();
                }
            }, 1000);
        }

        function showLearningTip() {
            const tips = [
                { title: 'üéí Les 5 Sacs Essentiels', content: 'S√©parer tes affaires permet de retrouver facilement ce dont tu as besoin, m√™me dans le noir !' },
                { title: 'üß• Technique des 3 Couches', content: 'Base (√©vacue transpiration) + Isolation (garde chaleur) + Protection (bloque vent/pluie)' },
                { title: 'üß¶ R√®gle des 2 Chaussettes', content: 'Toujours 2 paires minimum ! Une pour le jour, une s√®che pour le soir. Pieds mouill√©s = froid garanti !' }
            ];
            const tip = tips[Math.floor(Math.random() * tips.length)];
            document.getElementById('infoTitle').textContent = tip.title;
            document.getElementById('infoContent').innerHTML = `<div class="tip-card">${tip.content}</div>`;
        }

        function showItemTip(item) {
            if (item.tip) {
                document.getElementById('infoTitle').textContent = `${item.emoji} ${item.name}`;
                document.getElementById('infoContent').innerHTML = `<div class="tip-card"><strong>üí° Astuce :</strong> ${item.tip}</div>`;
            }
        }

        function generateWeather() {
            const conditions = [
                { icon: '‚òÄÔ∏è', temp: '18¬∞C', desc: 'Beau temps ensoleill√© - Pas besoin de surpantalon !', type: 'sun' },
                { icon: 'üåßÔ∏è', temp: '12¬∞C', desc: 'Pluie pr√©vue - Prends ton k-way et surpantalon !', type: 'rain' },
                { icon: '‚ùÑÔ∏è', temp: '5¬∞C', desc: 'Froid intense - Plusieurs couches n√©cessaires !', type: 'cold' },
                { icon: 'üå¶Ô∏è', temp: '15¬∞C', desc: 'Variable avec risque de pluie - Pr√©vois tout !', type: 'variable' }
            ];
            const weather = conditions[Math.floor(Math.random() * conditions.length)];
            document.getElementById('weatherIcon').textContent = weather.icon;
            document.getElementById('weatherTemp').textContent = weather.temp;
            document.getElementById('weatherDesc').textContent = weather.desc;
        }

        function validateGame() {
            winGame();
        }

        function winGame() {
            clearInterval(timerInterval);
            
            // Calculate bonus
            let bonus = 0;
            if (timeLeft > 60) bonus += 500;
            if (currentMode === 'expert') bonus += 1000;
            
            const finalScore = gameScore + bonus;
            playerData.totalScore += finalScore;
            
            // Update level
            playerData.level = Math.floor(playerData.totalScore / 1000) + 1;
            if (playerData.level >= 10) playerData.rank = 'Chef Scout';
            else if (playerData.level >= 5) playerData.rank = '√âclaireur';
            
            // Track mode completion
            if (!playerData.modesCompleted.includes(currentMode)) {
                playerData.modesCompleted.push(currentMode);
            }
            
            savePlayerData();
            updatePlayerStats();
            
            alert(`üéâ Bravo ! Score: ${finalScore} points\n\nTon sac est pr√™t pour le camp de Jambville ! üèïÔ∏è`);
            backToMenu();
        }

        function showAchievements() {
            showScreen('achievementsScreen');
            renderAchievements();
        }

        function renderAchievements() {
            const grid = document.getElementById('achievementGrid');
            grid.innerHTML = '';
            
            achievements.forEach(ach => {
                const unlocked = playerData.achievements.includes(ach.id);
                const el = document.createElement('div');
                el.className = `achievement ${unlocked ? 'unlocked' : 'locked'}`;
                el.innerHTML = `
                    <div class="achievement-emoji">${ach.emoji}</div>
                    <div class="achievement-name">${ach.name}</div>
                    <div style="font-size: 0.7rem; margin-top: 0.5rem; opacity: 0.8;">${ach.desc}</div>
                `;
                grid.appendChild(el);
            });
            
            const percent = Math.round((playerData.achievements.length / achievements.length) * 100);
            document.getElementById('achievementPercent').textContent = percent + '%';
            
            const circle = document.getElementById('achievementCircle');
            circle.style.background = `conic-gradient(var(--green) ${percent * 3.6}deg, var(--wood) 0deg)`;
        }

        function showReference() {
            alert('üìñ Guide de R√©f√©rence\n\n' + 
                  'üéí Sac & Couchage (5 items)\n' +
                  'üëï V√™tements (18 items)\n' +
                  'üöø Hygi√®ne (4 items)\n' +
                  'üçΩÔ∏è Repas (4 items)\n' +
                  'üéØ Divers (8 items)\n\n' +
                  'üí° R√®gle d\'or : Technique des 3 couches + R√®gle des 2 chaussettes !');
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function backToMenu() {
            clearInterval(timerInterval);
            showScreen('menuScreen');
            updatePlayerStats();
        }

        // Start
        init();
    </script>
</body>
</html>